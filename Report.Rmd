---
title: "IBM HR Employee Attrition Descriptive Analysis"
subtitle: "Statistical Computing WiSe '25 - Group Project"
author: "Amaan Shaikh | Danish Ali Shaikh | Rajat Pandey"
fontsize: 11pt
geometry: margin=0.5in
header-includes:
  - \usepackage{titlesec}
  - \titlespacing*{\section}{0pt}{1.2ex}{0.8ex}
  - \titlespacing*{\subsection}{0pt}{1.0ex}{0.6ex}
  - \titlespacing*{\subsubsection}{0pt}{0.8ex}{0.4ex}
  - \renewcommand{\arraystretch}{0.8}
  - \usepackage{float}
  - \usepackage{caption}
  - \captionsetup{font=small}
output:
  pdf_document:
    number_sections: true
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}

# Clear Environment.
rm(list = ls(all.names = TRUE))

# Load Packages.
library(dplyr)
library(ggplot2)

# Global Chunk Options. [Ref: https://lms.bht-berlin.de/mod/folder/view.php?id=1419650]
# 'dev' checks if it's PDF to use high-quality rendering, otherwise standard.
knitr::opts_chunk$set(
  echo      = FALSE,
  warning   = FALSE,
  message   = FALSE,
  fig.align = "center"
)

# ggplot theme.
theme_set(theme_minimal())
```

```{r helpers}

# ----------------- Helper functions to follow 'DRY' policy.--------------------

# This function allows for generating absolute, relative,
# cumulative absolute, and cumulative relative frequencies as a table.
#
# Arguments:
#   x:  any R object for which frequencies are to be obtained.
#   var_name: Variable name for which data is present in argument 'x'.
#   caption: Caption for the generated table. OPTIONAL.
#   show_cumulative: Required to be turned on in order to see cumulative
#                    frequencies. OPTIONAL. DEFAULT: FALSE
#   show_mode: Required to be turned on in order to highlight the modal
#              category in the frequency table. OPTIONAL. DEFAULT: FALSE
print_freq_table <- function(x,
                             var_name,
                             caption = NULL,
                             show_cumulative = FALSE,
                             show_mode = FALSE) {
  df            <- as.data.frame(table(x))
  colnames(df)  <- c(var_name, "Frequency")
  
  df$Proportion <- df$Frequency / sum(df$Frequency) * 100
  if (show_cumulative) {
    df$`Cum. Freq.` <- cumsum(df$Frequency)
    df$`Cum. %`     <- cumsum(df$Proportion)
  }
  
  if (show_mode) {
    mode_value     <- df[[var_name]][which.max(df$Frequency)]
    df[[var_name]] <- ifelse(df[[var_name]] == mode_value,
                             paste0("**", df[[var_name]], " (Mode)**"),
                             as.character(df[[var_name]]))
  }

  if (is.null(caption)) {
    caption <- paste(var_name, "Frequency Table")
  }
  
  knitr::kable(
    df,
    align   = c('l', 'c', 'c', 'c', 'c'),
    caption = caption,
    digits  = 2,
  )
}

# This function finds the mode for a given categorical variable.
#
# Arguments:
#   x: a vector, a data frame, an array - for which mode is to be obtained.
print_mode <- function(x) {
  uniqv <- unique(x)
  uniqv[which.max(tabulate(match(x, uniqv)))]
}

# This function generates a descriptive statistics table, a boxplot, and an ECDF
# plot for a continuous numeric variable to visualize distribution and outliers.
#
# Arguments:
#   data_vec:   a numeric vector containing the data to analyze (e.g., hr$Age).
#   var_name:   a string used for plot titles and table captions (e.g., "Age").
#   col_fill:   a string specifying the fill color for the boxplot.
#   col_border: a string specifying the border and outlier color for the boxplot.
#   col_line:   a string specifying the line color for the ECDF plot.
analyze_numeric <- function(data_vec,
                            var_name,
                            col_fill,
                            col_border,
                            col_line) {
  quantiles <- quantile(data_vec, probs = c(0.25, 0.5, 0.75))
  stats_df <- data.frame(
    Mean     = mean(data_vec),
    `1st Q`  = quantiles["25%"],
    Median   = quantiles["50%"],
    `3rd Q`  = quantiles["75%"],
    Variance = var(data_vec),
    SD       = sd(data_vec),
    Range    = paste(range(data_vec), collapse = " – "),
    IQR      = IQR(data_vec),
    check.names = FALSE # Allow `1st Q`.
  )
  
  rownames(stats_df) <- NULL # Remove row names for a cleaner table.
  
  # We use print() so it renders even when called inside a function.
  print(knitr::kable(
    stats_df,
    align   = 'c',
    caption = paste(
      "Descriptive Statistics:",
      var_name,
      "(Location & Dispersion)"
    ),
    digits  = 2
  ))
  
  par(mfrow = c(1, 2))
  par(mar = c(4, 4, 2, 1)) # Reduce margins.
  
  boxplot(
    data_vec,
    main        = paste("Boxplot of", var_name),
    ylab        = var_name,
    col         = col_fill,
    border      = col_border,
    outlier.col = col_border
  )
  
  plot(
    ecdf(data_vec),
    main      = paste("ECDF of", var_name),
    xlab      = var_name,
    ylab      = paste0("F(", var_name, ")"),
    col       = col_line,
    lwd       = 2,
    verticals = TRUE,
    pch       = NA
  )
  
  # Reset Layout.
  par(mfrow = c(1, 1))
}
```

# Introduction

The IBM HR Employee Attrition workforce data is organized as a data matrix of observations and qualitative and quantitative variables. This report performs a comprehensive descriptive statistical analysis to summarize the distribution of individual variables using frequencies, measures of location, and measures of dispersion. Bivariate techniques, including contingency tables and correlation coefficients, are applied to investigate the joint behavior and co-dependency between employee attributes and attrition. Furthermore, simple linear regression is utilized to model the linear relationship between tenure and monthly income by estimating the regression coefficients.

## Data Loading & Feature Selection
We analyze **eight** key variables classified into the following datatypes :

- **Categorical - Nominal**: `Attrition`, `OverTime`
- **Categorical - Ordinal**: `JobLevel` (1-5), `JobSatisfaction` (1-4), `WorkLifeBalance` (1-4)
- **Numeric - Continuous**: `Age`, `MonthlyIncome`
- **Numeric - Discrete**: `YearsAtCompany`

```{r load-data}

raw_data <- read.csv("data/ibm-hr-attrition.csv", stringsAsFactors = FALSE)
hr       <- raw_data[, c("Age", "Attrition", "JobLevel",
                         "JobSatisfaction", "MonthlyIncome", "OverTime",
                         "WorkLifeBalance", "YearsAtCompany")]
```

```{r preprocessing}

# Nominal Variables.
hr$Attrition <- as.factor(hr$Attrition)
hr$OverTime  <- as.factor(hr$OverTime)

# Ordinal Variables.
hr$JobLevel <- factor(
  hr$JobLevel,
  levels  = 1:5,
  labels  = c("Entry Level", "Junior", "Mid Level", "Senior", "Executive"),
  ordered = TRUE
)
hr$JobSatisfaction <- factor(
  hr$JobSatisfaction,
  levels  = 1:4,
  labels  = c("Low", "Medium", "High", "Very High"),
  ordered = TRUE
)
hr$WorkLifeBalance <- factor(
  hr$WorkLifeBalance,
  levels  = 1:4,
  labels  = c("Bad", "Good", "Better", "Best"),
  ordered = TRUE
)
```

## Data summary

The dataset contains **`r nrow(hr)`** observations and **`r ncol(hr)`** variables _(Selected from 35 variables)_.

```{r data-summary}

knitr::kable(t(head(hr)), caption = "First six observations (Transposed View)")
```

# Univariate Analysis

This section characterizes the workforce structure by analyzing the frequency distributions, measure of location, and dispersion of key **sentiment**, **financial**, and **demographic** variables.

## Target & Sentiment

This section performs a uni-variate analysis to characterize employee **sentiment** and **professional status**, examining the frequency distributions of key qualitative variables.

\newpage

### Attrition Status (Binary Nominal)
 
```{r attrition-univariate, fig.cap = 'Bar plot of Attrition Status illustrating a significant class imbalance with high employee retention', fig.height = 2.5, fig.width = 3}

print_freq_table(hr$Attrition, "Attrition Status")

ggplot(hr,
  aes(x = Attrition, fill = Attrition)) +
  geom_bar(width = 0.7) + # Bars
  geom_text(
    stat = 'count',
    aes(label = ..count..),
    vjust = 1.5,
    color = "white",
    fontface = "bold"
  ) +
  # Colors & Titles
  scale_fill_manual(values = c("steelblue", "firebrick")) +
  labs(title = "Attrition Status Barplot", x = "Attrition Status", y = "Absolute Frequency")
```

**Interpretation:** The analysis reveals a significant **class imbalance**, with **1,233** _(83.88%)_ active employees versus **237** _(16.12%)_ attrition cases. This distribution confirms a stable workforce and establishes a realistic baseline turnover rate for subsequent bivariate comparisons.

### Job Satisfaction (Ordinal)

```{r job-satisfaction-univariate}

print_freq_table(
  hr$JobSatisfaction,
  "Job Satisfaction",
  show_cumulative = TRUE,
  show_mode = TRUE
)
```

**Interpretation:** The data indicates **high** employee morale, with **"Very High"** _(31.2%, n=459)_ as the **modal** category. Cumulatively, over **61.29%** of the workforce reports **positive satisfaction** (High or Very High), significantly outweighing the **19.66%** who report **low** satisfaction.

### Work Life Balance (Ordinal)

```{r work-life-balance-univariate}

print_freq_table(
  hr$WorkLifeBalance,
  "Work Life Balance",
  show_cumulative = TRUE,
  show_mode = TRUE
)
```

**Interpretation:** The data reveals a **strong skew** toward positive work-life balance, with **"Better"** _(60.8%, n=893)_ as the dominant **modal** category. Cumulatively, **71.16%** of the workforce falls into the **top two tiers** ("Better" or "Best"), while only **5.44%** report a "Bad" balance.

## Financial Structure

This section summarizes the **job hierarchy**, **income distribution**, and **overtime** status of employees using uni-variate descriptive statistics and graphical representations to describe the compensation structure and workload intensity.

### Job Level (Ordinal)

```{r job-level-univariate}

print_freq_table(
  hr$JobLevel,
  "Job Level",
  show_cumulative = TRUE,
  show_mode = TRUE
)
```

**Interpretation:** The workforce structure exhibits a distinct pyramidal hierarchy, heavily concentrated in early-career roles. **Entry Level** _(36.9%, n=543)_ and **Junior** _(36.3%, n=534)_ positions **dominate**, cumulatively accounting for **73.27%** of the organization. In contrast, upper management is exclusive, with Executives representing only **4.69%** of the total population.

### Monthly Income (Continuous)

```{r monthly-income-univariate, fig.cap = 'Histogram of Monthly Income. The distribution is right-skewed, indicated by the Mean (Red) being higher than the Median (Blue)', fig.height = 3.5, fig.width = 4}

avg_inc <- mean(hr$MonthlyIncome)
med_inc <- median(hr$MonthlyIncome)
quants  <- quantile(hr$MonthlyIncome, probs = c(0.25, 0.5, 0.75))

par(mar = c(4, 4, 2, 1)) # Reduce margins. 

hist(
  hr$MonthlyIncome,
  main   = "Distribution of Monthly Income",
  xlab   = "Monthly Income (USD)",
  ylab   = "Absolute Frequency",
  col    = "steelblue",
  border = "white",
  ylim   = c(0, 400) # Increase Y-limit to ensure legend fits clearly.
)

# Add Vertical Lines (Mean & Median)
abline(
  v = avg_inc,
  col = "firebrick",
  lwd = 2,
  lty = 2
)
abline(
  v   = med_inc,
  col = "navy",
  lwd = 2,
  lty = 1
)

legend(
  "topright",
  legend = c(paste("Mean:", round(avg_inc, 0)), paste("Median:", round(med_inc, 0))),
  col    = c("firebrick", "navy"),
  lwd    = 2,
  lty    = c(2, 1), # Match line types (2=Dashed, 1=Solid)
  bty    = "n",
  cex    = 0.9
)

par(mar = c(5, 4, 4, 2) + 0.1) # Reset margins.

# Create Expanded Statistics Table.
inc_stats <- data.frame(
  Mean        = avg_inc,
  `1st Q`     = quants["25%"],
  Median      = quants["50%"],
  `3rd Q`     = quants["75%"],
  Variance    = var(hr$MonthlyIncome),
  SD          = sd(hr$MonthlyIncome),
  Range       = paste(range(hr$MonthlyIncome), collapse = " – "),
  IQR         = IQR(hr$MonthlyIncome),
  check.names = FALSE # Allow `1st Q`.
)

# Remove row names for a cleaner table.
rownames(inc_stats) <- NULL

knitr::kable(
  inc_stats,
  align   = 'c',
  caption = "Descriptive Statistics: Monthly Income (Location & Dispersion)",
  digits  = 2
)  
```

**Interpretation:** The distribution of monthly income is **strongly right-skewed**, evidenced by the **Mean** _(\$6,503)_ significantly exceeding the **Median** _(\$4,919)_. While the majority of employees cluster in the lower income brackets _(approx. \$2,500–\$5,000)_, a distinct **right tail** of **high earners** extends to nearly **$20,000**. This indicates that a small cohort of highly paid executives disproportionately inflates the average, resulting in **high variability** _(SD = \$4,708)_ across the workforce.

### Over Time (Binary Nominal)

```{r overtime-univariate}

print_freq_table(hr$OverTime, "Over Time")
```

**Interpretation:** The majority of the workforce _(71.7%, n=1,054)_ does **not work overtime**. However, a significant minority of **28.3%** _(n=416)_ actively engages in overtime, representing a distinct subgroup that may be more susceptible to burnout or attrition.

## Demographics

This section analyzes **Age** and **Years at Company** using descriptive statistics and distributional plots to characterize employee demographic composition and tenure.

### Age (Continuous)

```{r age-univariate, results = 'asis', fig.cap = "Distribution of employee age. The boxplot (left) summarizes dispersion and outliers, and the empirical cumulative distribution function (right) shows the cumulative age distribution", fig.height = 4, fig.pos = 'H'}

analyze_numeric(
  data_vec   = hr$Age,
  var_name   = "Age",
  col_fill   = "lightblue",
  col_border = "steelblue",
  col_line   = "darkred"
)
```

**Interpretation:** The age distribution is approximately symmetric and bell-shaped, spanning from **18** to **60** years with a standard deviation of **9.14**. The moderate variability **(IQR = 13)** indicates that the middle 50% of the workforce is concentrated within a relatively narrow age band, suggesting a demographically balanced employee base without extreme skewness.

### Years At Company (Numeric)

```{r years-at-company-univariate, results = 'asis', fig.cap = "Distribution of years at company showing low median tenure and a long right tail with high-tenure outliers", fig.height = 4, fig.pos = 'H'}

analyze_numeric(
  data_vec   = hr$YearsAtCompany,
  var_name   = "Years at Company",
  col_fill   = "lightgreen",
  col_border = "darkgreen",
  col_line   = "purple"
)
```

**Interpretation:** The distribution of tenure is **strongly right-skewed**, evidenced by the **Mean** _(7.01)_ exceeding the **Median** _(5.0)_. The boxplot reveals significant **upper outliers** _(up to 40 years)_, indicating that while the typical employee has a tenure of 5 years or less, a distinct cohort of long-term veterans remains, heavily influencing the average.

# Bivariate Analysis

This section investigates the relationships between pairs of variables to identify potential drivers of attrition. We employ contingency tables for categorical data and correlation matrices for numerical attributes.

## Impact of Sentiment on Attrition (Categorical vs. Categorical)

We analyze the relationship between **Job Satisfaction** and **Attrition** to determine if lower employee morale correlates with higher turnover.

```{r job-sat-vs-attrition, fig.cap = "Attrition counts across Job Satisfaction levels. Employees reporting 'Low' satisfaction show a higher relative frequency of attrition compared to those in the 'High' and 'Very High' categories", fig.height = 3, fig.width = 5, fig.pos = 'H'}

# Contingency Table with Margins.
tab_js_attr <- table(hr$Attrition, hr$JobSatisfaction)
tab_js_attr_margins <- addmargins(tab_js_attr)
knitr::kable(
  tab_js_attr_margins,
  align = c('l', 'c', 'c', 'c', 'c', 'c'),
  caption = "Attrition by Job Satisfaction Level (with Marginal Frequencies)"
)

# Conditional Relative Frequency Tables: Attrition vs Job Satisfaction
# Row percentages (distribution of satisfaction levels within each attrition group)
tab_js_rowprop <- prop.table(tab_js_attr, margin = 1)
knitr::kable(
  tab_js_rowprop,
  align   = c('l', 'c', 'c', 'c', 'c'),
  caption = "Row Relative Frequency: Job Satisfaction within Attrition Groups",
  digits  = 2
)

par(mar = c(3, 3, 2, 1))

# Grouped Barplot
barplot(
  tab_js_attr,
  beside = TRUE,
  main   = "Attrition by Job Satisfaction",
  legend = rownames(tab_js_attr),
  args.legend = list(
    x = "topright",
    # Position
    bty = "n",
    # No box border
    cex = 0.8,
    # Smaller text
    inset = c(-0.03, -0.05) # Slight adjust
  ),
  xlab  = "Satisfaction Level",
  col   = c("lightblue", "salmon")
)

par(mar = c(5, 4, 4, 2) + 0.1)
```

**Interpretation:** The analysis identifies low job satisfaction as a driver of attrition. Among employees who left the organization, 28% reported 'Low' satisfaction, compared to only 18% among those who stayed. The bar chart visually confirms this trend: as satisfaction levels rise, the volume of retained employees (Blue) increases substantially, indicating that higher morale is strongly linked to workforce stability.

## Financial Factors & Attrition

This section examines the relationship between Monthly Income and employee attrition to assess whether compensation levels differ between employees who stay and those who leave the organization. Group-wise summary statistics and correlation coefficients are used to describe the association between income and attrition status.

```{r monthly-income-attrition-bivariate}

income_by_attrition <- data.frame(
  Mean   = tapply(hr$MonthlyIncome, hr$Attrition, mean),
  Median = tapply(hr$MonthlyIncome, hr$Attrition, median),
  SD     = tapply(hr$MonthlyIncome, hr$Attrition, sd)
)
knitr::kable(
  income_by_attrition,
  caption = "Monthly Income Summary by Attrition (Mean, Median, SD)",
  digits  = 2
)

boxplot(
  MonthlyIncome ~ Attrition,
  data = hr,
  col  = c("lightblue", "salmon"),
  main = "Monthly Income by Attrition",
  xlab = "Attrition Status",
  ylab = "Monthly Income (USD)"
)

# Encode Attrition as numeric (Yes = 1, No = 0)
attrition_numeric <- as.numeric(hr$Attrition) - 1
```

**Interpretation:** Employees who left the organization earn lower monthly incomes than those who stayed, as reflected in both mean and median values.

## Demographics & Attrition
We examine the demographic profile of the workforce, specifically focusing on Age and Years at Company (Tenure). We compare the distributions of these variables across attrition groups to determine if younger or newer employees are at higher risk of leaving
```{r demographics-attrition, fig.cap="Demographic Drivers of Attrition: (Left) Age distribution showing a lower median age for leavers; (Right) Tenure distribution showing early-stage attrition among new hires.", fig.pos = 'H'}

par(mar = c(4, 4, 2, 1))

# Set up side-by-side plotting area
par(mfrow = c(1, 2))

# 1. Age vs Attrition
boxplot(
  Age ~ Attrition,
  data = hr,
  main = "Age by Attrition",
  xlab = "Attrition",
  ylab = "Age",
  col  = c("lightblue", "salmon")
)

# 2. Years at Company vs Attrition
boxplot(
  YearsAtCompany ~ Attrition,
  data = hr,
  main = "Tenure by Attrition",
  xlab = "Attrition",
  ylab = "Years at Company",
  col  = c("lightgreen", "salmon")
)

# Reset layout and margins.
par(mfrow = c(1, 1))
par(mar = c(5, 4, 4, 2) + 0.1)
```

**Interpretation:** The analysis confirms that attrition is primarily an early-career phenomenon. Employees who leave are generally younger (median age 32 vs. 36) and have significantly shorter tenure (median 3 years vs. 6 years) compared to those who stay. This indicates that the organization struggles most with retaining new and junior talent, rather than long-term employees.

# Linear Regression Analysis

## Correlation Analysis: Years at Company vs Monthly Income

Before proceeding with regression modeling, we examine the strength and nature of the relationship between tenure (Years at Company) and compensation (Monthly Income) using both Pearson and Spearman correlation coefficients. Pearson correlation measures the linear association between two continuous variables, while Spearman correlation assesses monotonic relationships based on ranked data and is more robust to outliers.

```{r correlation-years-income}

# Calculate Pearson correlation
pearson_corr <- cor(hr$YearsAtCompany, hr$MonthlyIncome, method = "pearson")

# Calculate Spearman correlation
spearman_corr <- cor(hr$YearsAtCompany, hr$MonthlyIncome, method = "spearman")

# Create correlation table
correlation_table <- data.frame(
  `Correlation Type` = c("Pearson", "Spearman"),
  `Coefficient` = c(pearson_corr, spearman_corr),
  check.names = FALSE
)

knitr::kable(
  correlation_table,
  align = c('l', 'c'),
  caption = "Pearson and Spearman Correlations: Years at Company vs Monthly Income",
  digits = 3
)
```

**Interpretation:** Both correlation coefficients reveal a **moderate positive relationship** between tenure and income. The Pearson correlation ($r$ = `r round(pearson_corr, 3)`) indicates a moderate linear association, while the Spearman correlation ($\rho$ = `r round(spearman_corr, 3)`) confirms that this relationship is consistently monotonic. The similarity between the two values suggests that the relationship is approximately linear without substantial influence from extreme outliers. This justifies the use of linear regression to model the relationship between these variables.

## Linear Regression: Monthly Income vs Years at Company

```{r monthly-income-vs-years-regression, fig.height=4, fig.width=6}

# Fit linear model
lm_fit <- lm(MonthlyIncome ~ YearsAtCompany, data = hr)

par(mar = c(4, 4, 2, 1))

# Simple base R scatter plot with regression line
smoothScatter(
  hr$YearsAtCompany,
  hr$MonthlyIncome,
  xlab = "Years at Company",
  ylab = "Monthly Income (USD)",
  main = "Monthly Income vs Years at Company",
  col = "#377eb8",
  pch = 19
)
abline(lm_fit, col = "#e41a1c", lwd = 2)

# Add legend at bottom right inside the plot, smaller size
legend(
  "bottomright",
  legend = c("Data", "Regression Line"),
  col = c("#377eb8", "#e41a1c"),
  pch = c(19, NA),
  lty = c(NA, 1),
  lwd = c(NA, 2),
  bty = "n",
  pt.cex = 0.8,
  cex = 0.85,
  x.intersp = 1.1,
  y.intersp = 1
)

# Extract values for the formula
b0 <- round(coef(lm_fit)[1], 2) # Intercept
b1 <- round(coef(lm_fit)[2], 2) # Slope
rse <- round(summary(lm_fit)$sigma, 2)   # Residual Standard Error

par(mar = c(5, 4, 4, 2) + 0.1)

# Regression summary as a table (no duplicate row index)
summary(lm_fit)
```

**Regression Equation:**
$$\widehat{\text{MonthlyIncome}} = `r b0` + `r b1`(\text{YearsAtCompany})$$

**Model Fit:**
$$\text{Residual Standard Error} = `r rse`$$

**Interpretation:** The regression analysis confirms a statistically significant positive relationship between tenure and compensation ($p < 0.001$). The model estimates that for every additional year an employee stays at the company, their monthly income increases by approximately **$395**, starting from a baseline of **$3,733**. However, the residual standard error of **4,039** suggests considerable variability in income that tenure alone does not explain.

# Conclusion
