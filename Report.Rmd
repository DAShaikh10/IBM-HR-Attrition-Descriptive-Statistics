---
title: "IBM HR Employee Attrition Descriptive Analysis"
subtitle: "Statistical Computing Group Project"
author: "Amaan Shaikh | Danish Ali Shaikh | Rajat Pandey"
fontsize: 11pt
geometry: margin=0.5in
header-includes:
  - \usepackage{titlesec}
  - \titlespacing*{\section}{0pt}{1.2ex}{0.8ex}
  - \titlespacing*{\subsection}{0pt}{1.0ex}{0.6ex}
  - \titlespacing*{\subsubsection}{0pt}{0.8ex}{0.4ex}
  - \renewcommand{\arraystretch}{0.8}
output:
  pdf_document:
    number_sections: true
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
# Clear Environment.
rm(list = ls(all.names = TRUE))

# Load Packages.
library(dplyr)
library(ggplot2)

# Global Chunk Options. [Ref: https://lms.bht-berlin.de/mod/folder/view.php?id=1419650]
# 'dev' checks if it's PDF to use high-quality rendering, otherwise standard.
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center"
)

# ggplot theme.
theme_set(theme_minimal())
```

```{r helpers, echo=FALSE}
# ----------------- Helper functions to follow 'DRY' policy.--------------------

# This function allows for generating absolute, relative,
# cumulative absolute, cumulative relative frequencies as  a table.
# 
# Arguments:
#   x:  any R object for which frequencies are to be obtained.
#   var_name: Variable name for which data is present in argument 'x'. 
#   caption: Caption for the generated table. OPTIONAL.
#   show_cumulative: Required to be turned on in order to see cumulative
#                    frequencies. OPTIONAL. DEFAULT: FALSE
#   show_mode: Required to be turned on in order to highlight the modal
#              category in the frequency table. OPTIONAL. DEFAULT: FALSE
print_freq_table <- function(x, var_name, caption = NULL,
                             show_cumulative = FALSE,
                             show_mode = FALSE) {
  
  x <- as.factor(x)
  
  df <- as.data.frame(table(x))
  colnames(df) <- c(var_name, "Frequency")
  
  df$Proportion <- round(100 * df$Frequency / sum(df$Frequency), 2)
  
  if (show_cumulative) {
    df$`Cum. Freq.` <- cumsum(df$Frequency)
    df$`Cum. %` <- cumsum(df$Proportion)
  }
  
  # Highlight mode ONLY if flag is TRUE
  if (show_mode) {
    mode_value <- df[[var_name]][which.max(df$Frequency)]
    
    df[[var_name]] <- ifelse(
      df[[var_name]] == mode_value,
      paste0("**", df[[var_name]], " (Mode)**"),
      as.character(df[[var_name]])
    )
  }
  
  if (is.null(caption)) {
    caption <- paste(var_name, "Frequency Table")
  }
  
  knitr::kable(
    df,
    caption = caption,
    align = c('l', 'c', 'c', 'c', 'c'),
    format = "markdown"
  )
}

# This function finds the mode for a given categorical variable.
#
# Arguments:
#   x: a vector, a data frame, an array - for which mode is to be obtained.
print_mode <- function(x) {
  uniqv <- unique(x)
  uniqv[which.max(tabulate(match(x, uniqv)))]
}
```

# Introduction

The IBM HR Employee Attrition workforce data is organized as a data matrix of observations and qualitative and quantitative variables. This report performs a comprehensive descriptive statistical analysis to summarize the distribution of individual variables using frequencies, measures of location, and measures of dispersion. Bivariate techniques, including contingency tables and correlation coefficients, are applied to investigate the joint behavior and co-dependency between employee attributes and attrition. Furthermore, simple linear regression is utilized to model the linear relationship between tenure and monthly income by estimating the regression coefficients.

## Data Loading & Feature Selection
We analyze **eight** key variables classified into the following datatypes :

- **Categorical - Nominal**: `Attrition`, `OverTime`
- **Categorical - Ordinal**: `JobLevel` (1-5), `JobSatisfaction` (1-4), `WorkLifeBalance` (1-4)
- **Numeric - Discrete**: `Age`, `YearsAtCompany`
- **Numeric - Continuous**: `MonthlyIncome`

```{r load-data, echo = FALSE}
raw_data     <- read.csv("data/ibm-hr-attrition.csv", stringsAsFactors = FALSE)
hr           <- raw_data[, c("Attrition", "OverTime", "JobLevel",
                             "JobSatisfaction", "WorkLifeBalance", "Age",
                             "YearsAtCompany", "MonthlyIncome")]
```

```{r preprocessing, echo = FALSE}
# Nominal Variables.
hr$Attrition <- as.factor(hr$Attrition)
hr$OverTime  <- as.factor(hr$OverTime)

# Ordinal Variables.
hr$JobLevel        <- factor(hr$JobLevel, 
                             levels = 1:5, 
                             labels = c("Entry Level", "Junior", "Mid Level", "Senior", "Executive"), 
                             ordered = TRUE)
hr$JobSatisfaction <- factor(hr$JobSatisfaction, 
                             levels = 1:4, 
                             labels = c("Low", "Medium", "High", "Very High"), 
                             ordered = TRUE)
hr$WorkLifeBalance <- factor(hr$WorkLifeBalance, 
                             levels = 1:4, 
                             labels = c("Bad", "Good", "Better", "Best"), 
                             ordered = TRUE)
```

## Data summary

The dataset contains `r nrow(hr)` observations and `r ncol(hr)` variables.

```{r data-summary, echo = FALSE, results = 'asis'}
knitr::kable(t(head(hr)), caption = "First six observations (Transposed View)")
```

# Univariate Analysis

## Target & Sentiment

This section performs a uni-variate analysis to characterize employee sentiment and professional status, examining the frequency distributions of key qualitative variables.

### Attrition Status (Binary Nominal)
 
```{r attrition-univariate, echo = FALSE, fig.cap = 'Bar plot of Attrition Status illustrating a significant class imbalance with high employee retention', fig.height = 2.5, fig.width = 3}
print_freq_table(hr$Attrition, "Attrition Status")

ggplot(hr, aes(x = Attrition, fill = Attrition)) +
  # Bars
  geom_bar(width = 0.7) +
  # Labels (Counts inside bars)
  geom_text(stat = 'count', aes(label = ..count..), vjust = 1.5, color = "white", fontface = "bold") +
  # Colors & Titles
  scale_fill_manual(values = c("steelblue", "firebrick")) +
  labs(title = "Attrition Status Barplot", 
       x = "Attrition Status", 
       y = "Absolute Frequency")
```

**Interpretation:** The analysis reveals a significant class imbalance, with 1,233 (83.9%) active employees versus 237 (16.1%) attrition cases. This distribution confirms a stable workforce and establishes a realistic baseline turnover rate for subsequent bivariate comparisons.

### Job Satisfaction (Ordinal)

```{r job-satisfaction-univariate, echo = FALSE, results = 'asis'}
print_freq_table(hr$JobSatisfaction, "Job Satisfaction", show_cumulative = TRUE, show_mode = TRUE)
```

### Work Life Balance (Ordinal)

```{r work-life-balance-univariate, echo = FALSE, results = 'asis'}
print_freq_table(hr$WorkLifeBalance, "Work Life Balance", show_cumulative = TRUE, show_mode = TRUE)
```

## Financial Structure

This section summarizes the job hierarchy, income distribution, and overtime status of employees using uni-variate descriptive statistics and graphical representations to describe the compensation structure and workload intensity.

### Job Level (Ordinal)

```{r job-level-univariate, echo = FALSE}
print_freq_table(hr$JobLevel, "Job Level", show_cumulative = TRUE, show_mode = TRUE)
```

### Monthly Income (Continuous)

```{r monthly-income-univariate, echo = FALSE, fig.cap = 'Histogram of Monthly Income. The distribution is right-skewed, indicated by the Mean (Red) being higher than the Median (Blue)', fig.height = 3.5, fig.width = 4}
avg_inc <- mean(hr$MonthlyIncome)
med_inc <- median(hr$MonthlyIncome)
quants  <- quantile(hr$MonthlyIncome, probs = c(0.25, 0.5, 0.75))

# 2. Draw Histogram
hist(
  hr$MonthlyIncome,
  main = "Distribution of Monthly Income",
  xlab = "Monthly Income (USD)",
  ylab = "Frequency",
  col = "steelblue",
  border = "white",
  # Increase Y-limit to ensure legend fits clearly
  ylim = c(0, 400) 
)

# 3. Add Vertical Lines (Mean & Median)
abline(v = avg_inc, col = "firebrick", lwd = 2, lty = 2) # Mean = Red Dashed
abline(v = med_inc, col = "navy",      lwd = 2, lty = 1) # Median = Blue Solid

# 4. Add Combined Legend
legend("topright", 
       legend = c(paste("Mean:", round(avg_inc, 0)), 
                  paste("Median:", round(med_inc, 0))), 
       col = c("firebrick", "navy"), 
       lwd = 2, 
       lty = c(2, 1), # Match line types (2=Dashed, 1=Solid)
       bty = "n",
       cex = 0.9)

# 5. Create Expanded Statistics Table
inc_stats <- data.frame(
  Mean     = round(avg_inc, 2),
  `1st Q`  = quants["25%"],
  Median   = quants["50%"],
  `3rd Q`  = quants["75%"],
  Variance = round(var(hr$MonthlyIncome), 2),
  SD       = round(sd(hr$MonthlyIncome), 2),
  Range    = paste(range(hr$MonthlyIncome), collapse = " – "),
  IQR      = IQR(hr$MonthlyIncome)
)

# Remove row names (usually "25%" etc) for a cleaner table
rownames(inc_stats) <- NULL

knitr::kable(
  inc_stats,
  caption = "Descriptive Statistics: Monthly Income (Location & Dispersion)",
  align = 'c'
)
```

### Over Time (Binary Nominal)

```{r overtime-univariate, echo = FALSE}
print_freq_table(hr$OverTime, "Over Time")
```
## Demographics

This section analyzes Age and Years at Company using descriptive statistics and distributional plots to characterize employee demographic composition and tenure.

### Age (Numeric)

```{r age-univariate}
age_stats <- data.frame(
  Variance = round(var(hr$Age), 2),
  SD = round(sd(hr$Age), 2),
  Range = paste(range(hr$Age), collapse = " – "),
  IQR = IQR(hr$Age)
)
knitr::kable(age_stats, caption = "Descriptive Statistics: Age")

par(mfrow = c(1, 2))

boxplot(
  hr$Age,
  main = "Boxplot of Age",
  ylab = "Age",
  col = "lightblue",
  border = "steelblue",
  outlier.col = "darkblue"
)

plot(
  ecdf(hr$Age),
  main = "Empirical CDF of Age",
  xlab = "Age",
  ylab = "F(Age)",
  col = "darkred",
  lwd = 2
)
par(mfrow = c(1, 1))
```
### Years At Company (Numeric)

```{r years-at-company-univariate}
yac_stats <- data.frame(
  Mean     = round(mean(hr$YearsAtCompany), 2),
  Median   = round(median(hr$YearsAtCompany), 2),
  Variance = round(var(hr$YearsAtCompany), 2),
  SD       = round(sd(hr$YearsAtCompany), 2),
  IQR      = IQR(hr$YearsAtCompany),
  Range    = paste(range(hr$YearsAtCompany), collapse = " – ")
)

knitr::kable(yac_stats, caption = "Descriptive Statistics: Years at Company")

par(mfrow = c(1, 2))
boxplot(
  hr$YearsAtCompany,
  main = "Boxplot of Years at Company",
  ylab = "Years at Company",
  col = "lightgreen",
  border = "darkgreen",
  outlier.col = "darkgreen"
)

plot(
  ecdf(hr$YearsAtCompany),
  main = "Empirical CDF of Years at Company",
  xlab = "Years at Company",
  ylab = "F(Years at Company)",
  col = "purple",
  lwd = 2
)
par(mfrow = c(1, 1))
```

# Bivariate Analysis

## Impact of Sentiment on Attrition

## Financial Factors & Attrition

## Demographics & Attrition

# Linear Regression Analysis

# Conclusion
