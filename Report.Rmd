---
title: "IBM HR Employee Attrition Descriptive Analysis"
subtitle: "Statistical Computing Group Project"
author: "Amaan Shaikh | Danish Ali Shaikh | Rajat Pandey"
output:
  pdf_document:
    number_sections: true
fontsize: 11pt
geometry: margin=0.5in
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
# Clear Environment.
rm(list = ls(all.names = TRUE))

# Load Packages.
library(dplyr)
library(ggplot2)

# Global Chunk Options. [Ref: https://lms.bht-berlin.de/mod/folder/view.php?id=1419650]
# 'dev' checks if it's PDF to use high-quality rendering, otherwise standard.
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.width = 4,
  fig.height = 3.5,
  fig.align = "center",
  out.width = "90%"
)

# ggplot theme.
theme_set(theme_minimal())
```

```{r helpers, echo=FALSE}
# ----------------- Helper functions to follow 'DRY' policy.--------------------

# This function allows for generating absolute, relative,
# cumulative absolute, cumulative relative frequencies as  a table.
# 
# Arguments:
#   x:  any R object for which frequencies are to be obtained.
#   var_name: Variable name for which data is present in argument 'x'. 
#   caption: Caption for the generated table. OPTIONAL.
#   show_cumulative: Required to be turned on in order to see cumulative
#                    frequencies. OPTIONAL. DEFAULT: FALSE
print_freq_table <- function(x, var_name, caption = NULL, show_cumulative = FALSE) {
  df <- as.data.frame(table(x))
  
  colnames(df) <- c(var_name, "Frequency")
  
  # Calculate Relative Frequency (Percentage or Proportion)
  df$Proportion <- round(100 * df$Frequency / sum(df$Frequency), 2)
  
  # Optionally, calculate Cumulative Absolute and Cumulative Relative Frequencies. 
  if (show_cumulative) {
    df$`Cum. Freq.` <- cumsum(df$Frequency)
    df$`Cum. %`    <- cumsum(df$Proportion)
  }
  
  # Handle Caption (Auto-generate if NULL)
  if (is.null(caption)) {
    caption <- paste(var_name, "Frequency Table")
  }
  
  knitr::kable(
    df,
    caption = caption,
    align = c('l', 'c', 'c', 'c', 'c'),
    format = "markdown"
  )
}

# This function finds the mode for a given categorical variable.
#
# Arguments:
#   x: a vector, a data frame, an array - for which mode is to be obtained.
print_mode <- function(x) {
  uniqv <- unique(x)
  uniqv[which.max(tabulate(match(x, uniqv)))]
}
```

# Introduction

The IBM HR Employee Attrition workforce data is organized as a data matrix of observations and qualitative and quantitative variables. This report performs a comprehensive descriptive statistical analysis to summarize the distribution of individual variables using frequencies, measures of location, and measures of dispersion. Bivariate techniques, including contingency tables and correlation coefficients, are applied to investigate the joint behavior and co-dependency between employee attributes and attrition. Furthermore, simple linear regression is utilized to model the linear relationship between tenure and monthly income by estimating the regression coefficients.

## Data Loading & Feature Selection
We analyze **eight** key variables classified into the following datatypes :

- **Categorical - Nominal**: `Attrition`, `OverTime`
- **Categorical - Ordinal**: `JobLevel` (1-5), `JobSatisfaction` (1-4), `WorkLifeBalance` (1-4)
- **Numeric - Discrete**: `Age`, `YearsAtCompany`
- **Numeric - Continuous**: `MonthlyIncome`

```{r load-data, echo = FALSE}
raw_data     <- read.csv("data/ibm-hr-attrition.csv", stringsAsFactors = FALSE)
hr           <- raw_data[, c("Attrition", "OverTime", "JobLevel",
                             "JobSatisfaction", "WorkLifeBalance", "Age",
                             "YearsAtCompany", "MonthlyIncome")]
```

```{r preprocessing, echo = FALSE}
# Nominal Variables.
hr$Attrition <- as.factor(hr$Attrition)
hr$OverTime  <- as.factor(hr$OverTime)

# Ordinal Variables.
hr$JobLevel        <- factor(hr$JobLevel, 
                             levels = 1:5, 
                             labels = c("Entry Level", "Junior", "Mid Level", "Senior", "Executive"), 
                             ordered = TRUE)
hr$JobSatisfaction <- factor(hr$JobSatisfaction, 
                             levels = 1:4, 
                             labels = c("Low", "Medium", "High", "Very High"), 
                             ordered = TRUE)
hr$WorkLifeBalance <- factor(hr$WorkLifeBalance, 
                             levels = 1:4, 
                             labels = c("Bad", "Good", "Better", "Best"), 
                             ordered = TRUE)
```

## Data summary

```{r data-summary, echo = FALSE, results = 'asis'}
paste("Dataset Dimensions:", nrow(hr), "rows x", ncol(hr), "columns.")
knitr::kable(t(head(hr)), caption = "First six observations (Transposed View)")
```

# Univariate Analysis

## Target & Sentiment

This section performs a uni-variate analysis to characterize employee sentiment and professional status, examining the frequency distributions of key qualitative variables.

### Attrition Status (Binary Nominal)
 
```{r attrition-univariate, echo = FALSE, fig.height=3, fig.width=5}
print_freq_table(hr$Attrition, "Attrition Status")

ggplot(hr, aes(x = Attrition, fill = Attrition)) +
  # Bars
  geom_bar(width = 0.7) +
  # Labels (Counts inside bars)
  geom_text(stat = 'count', aes(label = ..count..), vjust = 1.5, color = "white", fontface = "bold") +
  # Colors & Titles
  scale_fill_manual(values = c("steelblue", "firebrick")) +
  labs(title = "Attrition Status Barplot", 
       x = "Attrition Status", 
       y = "Absolute Frequency")
```

### Job Satisfaction (Ordinal)

```{r job-satisfaction-univariate, echo = FALSE, results = 'asis'}
print_freq_table(hr$JobSatisfaction, "Job Satisfaction", show_cumulative = TRUE)
print_mode(hr$JobSatisfaction)
```

### Work Life Balance (Ordinal)

```{r work-life-balance-univariate, echo = FALSE, results = 'asis'}
print_freq_table(hr$WorkLifeBalance, "Work Life Balance", show_cumulative = TRUE)
print_mode(hr$WorkLifeBalance)
```

## Financial Structure

What is the job structure and compensation?

### Job Level (Ordinal)

```{r job-level-univariate, echo = FALSE}
print_freq_table(hr$JobLevel, "Job Level", show_cumulative = TRUE)
print_mode(hr$JobLevel)
```
### Monthly Income (Continuous)

```{r monthly-income-univariate, echo = FALSE}
par(mfrow = c(1, 2))

hist(hr$MonthlyIncome, main="Histogram of Income", xlab="Monthly Income", 
     col="lightgray", border="white")

boxplot(hr$MonthlyIncome, main="Boxplot of Income", ylab="Income", 
        col="lightgray", horizontal=TRUE)

inc_stats <- data.frame(
  Variance = round(var(hr$MonthlyIncome), 2),
  SD = round(sd(hr$MonthlyIncome), 2),
  Range = paste(range(hr$MonthlyIncome), collapse = " – "),
  IQR = IQR(hr$MonthlyIncome)
)

knitr::kable(inc_stats, caption = "Descriptive Statistics: Monthly Income")
```

### Over Time (Binary Nominal)

```{r overtime-univariate, echo = FALSE}
print_freq_table(hr$OverTime, "Over Time")
```
## Demographics

Who are they (Time) and can we model their growth?

### Age (Numeric)

```{r age-univariate}
age_stats <- data.frame(
  Variance = round(var(hr$Age), 2),
  SD = round(sd(hr$Age), 2),
  Range = paste(range(hr$Age), collapse = " – "),
  IQR = IQR(hr$Age)
)
knitr::kable(age_stats, caption = "Descriptive Statistics: Age")

par(mfrow = c(1, 2))

boxplot(hr$Age)
plot(ecdf(hr$Age))
```
### Years At Company (Numeric)

```{r years-at-company-univariate}
yac_stats <- data.frame(
  Mean     = round(mean(hr$YearsAtCompany), 2),
  Median   = round(median(hr$YearsAtCompany), 2),
  Variance = round(var(hr$YearsAtCompany), 2),
  SD       = round(sd(hr$YearsAtCompany), 2),
  IQR      = IQR(hr$YearsAtCompany),
  Range    = paste(range(hr$YearsAtCompany), collapse = " – ")
)

knitr::kable(yac_stats, caption = "Descriptive Statistics: Years at Company")

par(mfrow = c(1, 2))
boxplot(hr$YearsAtCompany)
plot(ecdf(hr$YearsAtCompany))
```

# Bivariate Analysis

## Impact of Sentiment on Attrition

## Financial Factors & Attrition

## Demographics & Attrition

# Linear Regression Analysis

# Conclusion
