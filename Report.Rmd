---
title: "IBM HR Employee Attrition Descriptive Analysis"
subtitle: "Statistical Computing Group Project"
author: "Amaan Shaikh | Danish Ali Shaikh | Rajat Pandey"
fontsize: 11pt
geometry: margin=0.5in
header-includes:
  - \usepackage{titlesec}
  - \titlespacing*{\section}{0pt}{1.2ex}{0.8ex}
  - \titlespacing*{\subsection}{0pt}{1.0ex}{0.6ex}
  - \titlespacing*{\subsubsection}{0pt}{0.8ex}{0.4ex}
  - \renewcommand{\arraystretch}{0.8}
  - \usepackage{float}
output:
  pdf_document:
    number_sections: true
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
# Clear Environment.
rm(list = ls(all.names = TRUE))

# Load Packages.
library(dplyr)
library(ggplot2)

# Global Chunk Options. [Ref: https://lms.bht-berlin.de/mod/folder/view.php?id=1419650]
# 'dev' checks if it's PDF to use high-quality rendering, otherwise standard.
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center"
)

# ggplot theme.
theme_set(theme_minimal())
```

```{r helpers}
# ----------------- Helper functions to follow 'DRY' policy.--------------------

# This function allows for generating absolute, relative,
# cumulative absolute, cumulative relative frequencies as  a table.
#
# Arguments:
#   x:  any R object for which frequencies are to be obtained.
#   var_name: Variable name for which data is present in argument 'x'.
#   caption: Caption for the generated table. OPTIONAL.
#   show_cumulative: Required to be turned on in order to see cumulative
#                    frequencies. OPTIONAL. DEFAULT: FALSE
#   show_mode: Required to be turned on in order to highlight the modal
#              category in the frequency table. OPTIONAL. DEFAULT: FALSE
print_freq_table <- function(x, var_name, caption = NULL,
                             show_cumulative = FALSE,
                             show_mode = FALSE) {
  x <- as.factor(x)

  df <- as.data.frame(table(x))
  colnames(df) <- c(var_name, "Frequency")

  df$Proportion <- round(100 * df$Frequency / sum(df$Frequency), 2)

  if (show_cumulative) {
    df$`Cum. Freq.` <- cumsum(df$Frequency)
    df$`Cum. %` <- cumsum(df$Proportion)
  }

  # Highlight mode ONLY if flag is TRUE
  if (show_mode) {
    mode_value <- df[[var_name]][which.max(df$Frequency)]

    df[[var_name]] <- ifelse(
      df[[var_name]] == mode_value,
      paste0("**", df[[var_name]], " (Mode)**"),
      as.character(df[[var_name]])
    )
  }

  if (is.null(caption)) {
    caption <- paste(var_name, "Frequency Table")
  }

  knitr::kable(
    df,
    caption = caption,
    align = c('l', 'c', 'c', 'c', 'c'),
    format = "markdown"
  )
}

# This function finds the mode for a given categorical variable.
#
# Arguments:
#   x: a vector, a data frame, an array - for which mode is to be obtained.
print_mode <- function(x) {
  uniqv <- unique(x)
  uniqv[which.max(tabulate(match(x, uniqv)))]
}

# This function generates a descriptive statistics table, a boxplot, and an ECDF 
# plot for a continuous numeric variable to visualize distribution and outliers.
#
# Arguments:
#   data_vec:   a numeric vector containing the data to analyze (e.g., hr$Age).
#   var_name:   a string used for plot titles and table captions (e.g., "Age").
#   col_fill:   a string specifying the fill color for the boxplot.
#   col_border: a string specifying the border and outlier color for the boxplot.
#   col_line:   a string specifying the line color for the ECDF plot.
analyze_numeric <- function(data_vec, var_name, col_fill, col_border, col_line) {
  quants <- quantile(data_vec, probs = c(0.25, 0.5, 0.75))

  stats_df <- data.frame(
    Mean     = round(mean(data_vec), 2),
    `1st Q`  = quants["25%"],
    Median   = quants["50%"],
    `3rd Q`  = quants["75%"],
    Variance = round(var(data_vec), 2),
    SD       = round(sd(data_vec), 2),
    Range    = paste(range(data_vec), collapse = " – "),
    IQR      = IQR(data_vec),
    check.names = FALSE
  )

  rownames(stats_df) <- NULL

  # We use print() so it renders even when called inside a function
  print(knitr::kable(stats_df,
                     align = 'c',
                     caption = paste("Descriptive Statistics:", var_name, "(Location & Dispersion)"),
                     format = "markdown"))

  par(mfrow = c(1, 2))
  par(mar = c(4, 4, 2, 1)) # Optional: Tighter margins

  boxplot(data_vec,
          main = paste("Boxplot of", var_name),
          ylab = var_name,
          col = col_fill,
          border = col_border,
          outlier.col = col_border)

  plot(ecdf(data_vec),
       main = paste("ECDF of", var_name),
       xlab = var_name,
       ylab = paste("F(", var_name, ")", sep=""),
       col = col_line,
       lwd = 2,
       verticals = TRUE,
       pch = NA)

  # Reset Layout.
  par(mfrow = c(1, 1))
}
```

# Introduction

The IBM HR Employee Attrition workforce data is organized as a data matrix of observations and qualitative and quantitative variables. This report performs a comprehensive descriptive statistical analysis to summarize the distribution of individual variables using frequencies, measures of location, and measures of dispersion. Bivariate techniques, including contingency tables and correlation coefficients, are applied to investigate the joint behavior and co-dependency between employee attributes and attrition. Furthermore, simple linear regression is utilized to model the linear relationship between tenure and monthly income by estimating the regression coefficients.

## Data Loading & Feature Selection
We analyze **eight** key variables classified into the following datatypes :

- **Categorical - Nominal**: `Attrition`, `OverTime`
- **Categorical - Ordinal**: `JobLevel` (1-5), `JobSatisfaction` (1-4), `WorkLifeBalance` (1-4)
- **Numeric - Discrete**: `YearsAtCompany`
- **Numeric - Continuous**: `Age`, `MonthlyIncome`

```{r load-data}

raw_data     <- read.csv("data/ibm-hr-attrition.csv", stringsAsFactors = FALSE)
hr           <- raw_data[, c("Attrition", "OverTime", "JobLevel",
                             "JobSatisfaction", "WorkLifeBalance", "Age",
                             "YearsAtCompany", "MonthlyIncome")]
```

```{r preprocessing}

# Nominal Variables.
hr$Attrition <- as.factor(hr$Attrition)
hr$OverTime  <- as.factor(hr$OverTime)

# Ordinal Variables.
hr$JobLevel        <- factor(hr$JobLevel, 
                             levels = 1:5, 
                             labels = c("Entry Level", "Junior", "Mid Level", "Senior", "Executive"), 
                             ordered = TRUE)
hr$JobSatisfaction <- factor(hr$JobSatisfaction, 
                             levels = 1:4, 
                             labels = c("Low", "Medium", "High", "Very High"), 
                             ordered = TRUE)
hr$WorkLifeBalance <- factor(hr$WorkLifeBalance, 
                             levels = 1:4, 
                             labels = c("Bad", "Good", "Better", "Best"), 
                             ordered = TRUE)
```

## Data summary

The dataset contains `r nrow(hr)` observations and `r ncol(hr)` variables.

```{r data-summary}

knitr::kable(t(head(hr)),
             caption = "First six observations (Transposed View)")
```

# Univariate Analysis

## Target & Sentiment

This section performs a uni-variate analysis to characterize employee sentiment and professional status, examining the frequency distributions of key qualitative variables.

\newpage

### Attrition Status (Binary Nominal)
 
```{r attrition-univariate, fig.cap = 'Bar plot of Attrition Status illustrating a significant class imbalance with high employee retention', fig.height = 2.5, fig.width = 3}

print_freq_table(hr$Attrition, "Attrition Status")

ggplot(hr, aes(x = Attrition, fill = Attrition)) +
      # Bars
      geom_bar(width = 0.7) +
      # Labels (Counts inside bars)
      geom_text(stat = 'count', aes(label = ..count..), vjust = 1.5, color = "white", fontface = "bold") +
      # Colors & Titles
      scale_fill_manual(values = c("steelblue", "firebrick")) +
      labs(title = "Attrition Status Barplot", 
           x = "Attrition Status", 
           y = "Absolute Frequency")
```

**Interpretation:** The analysis reveals a significant class imbalance, with 1,233 (83.9%) active employees versus 237 (16.1%) attrition cases. This distribution confirms a stable workforce and establishes a realistic baseline turnover rate for subsequent bivariate comparisons.

### Job Satisfaction (Ordinal)

```{r job-satisfaction-univariate, results = 'asis'}

print_freq_table(hr$JobSatisfaction,
                 "Job Satisfaction",
                 show_cumulative = TRUE,
                 show_mode = TRUE)
```

**Interpretation:** The data indicates high employee morale, with "Very High" (31.2%, n=459) as the modal category. Cumulatively, over 61% of the workforce reports positive satisfaction (High or Very High), significantly outweighing the 19.7% who report Low satisfaction.


### Work Life Balance (Ordinal)

```{r work-life-balance-univariate, results = 'asis'}

print_freq_table(hr$WorkLifeBalance,
                 "Work Life Balance",
                 show_cumulative = TRUE,
                 show_mode = TRUE)
```

**Interpretation:** The data reveals a strong skew toward positive work-life balance, with "Better" (60.8%, n=893) as the dominant modal category. Cumulatively, 71.2% of the workforce falls into the top two tiers ("Better" or "Best"), while only 5.4% report a "Bad" balance.

## Financial Structure

This section summarizes the job hierarchy, income distribution, and overtime status of employees using uni-variate descriptive statistics and graphical representations to describe the compensation structure and workload intensity.

### Job Level (Ordinal)

```{r job-level-univariate}

print_freq_table(hr$JobLevel,
                 "Job Level",
                 show_cumulative = TRUE,
                 show_mode = TRUE)
```

**Interpretation:** The workforce structure exhibits a distinct pyramidal hierarchy, heavily concentrated in early-career roles. Entry Level (36.9%, n=543) and Junior (36.3%, n=534) positions dominate, cumulatively accounting for 73.3% of the organization. In contrast, upper management is exclusive, with Executives representing only 4.7% of the total population.

### Monthly Income (Continuous)

```{r monthly-income-univariate, fig.cap = 'Histogram of Monthly Income. The distribution is right-skewed, indicated by the Mean (Red) being higher than the Median (Blue)', fig.height = 3.5, fig.width = 4}

avg_inc <- mean(hr$MonthlyIncome)
med_inc <- median(hr$MonthlyIncome)
quants  <- quantile(hr$MonthlyIncome, probs = c(0.25, 0.5, 0.75))

# 2. Draw Histogram
hist(
  hr$MonthlyIncome,
  main = "Distribution of Monthly Income",
  xlab = "Monthly Income (USD)",
  ylab = "Frequency",
  col = "steelblue",
  border = "white",
  # Increase Y-limit to ensure legend fits clearly
  ylim = c(0, 400) 
)

# 3. Add Vertical Lines (Mean & Median)
abline(v = avg_inc, col = "firebrick", lwd = 2, lty = 2) # Mean = Red Dashed
abline(v = med_inc, col = "navy",      lwd = 2, lty = 1) # Median = Blue Solid

# 4. Add Combined Legend
legend("topright", 
       legend = c(paste("Mean:", round(avg_inc, 0)), 
                  paste("Median:", round(med_inc, 0))), 
       col = c("firebrick", "navy"), 
       lwd = 2, 
       lty = c(2, 1), # Match line types (2=Dashed, 1=Solid)
       bty = "n",
       cex = 0.9)

# 5. Create Expanded Statistics Table
inc_stats <- data.frame(
  Mean     = round(avg_inc, 2),
  `1st Q`  = quants["25%"],
  Median   = quants["50%"],
  `3rd Q`  = quants["75%"],
  Variance = round(var(hr$MonthlyIncome), 2),
  SD       = round(sd(hr$MonthlyIncome), 2),
  Range    = paste(range(hr$MonthlyIncome), collapse = " – "),
  IQR      = IQR(hr$MonthlyIncome)
)

# Remove row names (usually "25%" etc) for a cleaner table
rownames(inc_stats) <- NULL

knitr::kable(
  inc_stats,
  caption = "Descriptive Statistics: Monthly Income (Location & Dispersion)",
  align = 'c'
)
```

**Interpretation:** The workforce structure exhibits a distinct pyramidal hierarchy, heavily concentrated in early-career roles. Entry Level (36.9%, n=543) and Junior (36.3%, n=534) positions dominate, cumulatively accounting for 73.3% of the organization. In contrast, upper management is exclusive, with Executives representing only 4.7% of the total population.

### Over Time (Binary Nominal)

```{r overtime-univariate}

print_freq_table(hr$OverTime, "Over Time")
```

**Interpretation:** The majority of the workforce (71.7%, n=1,054) does not work overtime. However, a significant minority of 28.3% (n=416) actively engages in overtime, representing a distinct subgroup that may be more susceptible to burnout or attrition.

## Demographics

This section analyzes Age and Years at Company using descriptive statistics and distributional plots to characterize employee demographic composition and tenure.

### Age (Continuous)

```{r age-univariate, results = 'asis', fig.cap = "Distribution of employee age. The boxplot (left) summarizes dispersion and outliers, and the empirical cumulative distribution function (right) shows the cumulative age distribution", fig.pos = "H"}

analyze_numeric(data_vec   = hr$Age,
                var_name   = "Age",
                col_fill   = "lightblue",
                col_border = "steelblue",
                col_line   = "darkred")
```

**Interpretation:** The age distribution is approximately symmetric and bell-shaped, spanning from 18 to 60 years with a standard deviation of 9.14. The moderate variability (IQR = 13) indicates that the middle 50% of the workforce is concentrated within a relatively narrow age band, suggesting a demographically balanced employee base without extreme skewness.

### Years At Company (Numeric)

```{r years-at-company-univariate, results = 'asis', fig.cap="Distribution of years at company showing low median tenure and a long right tail with high-tenure outliers", fig.pos = "H"}

analyze_numeric(data_vec   = hr$YearsAtCompany,
                var_name   = "Years at Company",
                col_fill   = "lightgreen",
                col_border = "darkgreen",
                col_line   = "purple")
```

**Interpretation:** The distribution of tenure is strongly right-skewed, evidenced by the Mean (7.01) exceeding the Median (5.0). The boxplot reveals significant upper outliers (up to 40 years), indicating that while the typical employee has a tenure of 5 years or less, a distinct cohort of long-term veterans remains, heavily influencing the average."

# Bivariate Analysis

## Impact of Sentiment on Attrition

## Financial Factors & Attrition

## Demographics & Attrition

# Linear Regression Analysis

# Conclusion
